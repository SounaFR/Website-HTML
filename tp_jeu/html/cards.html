<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <script src="/javascript/head.js"></script>
        <title>TP JEU</title>

        <link rel="stylesheet" href="/tp_jeu/css/tp_jeu.css">
    </head>
    <body>
        <script src="/javascript/navbar.js"></script>
        
        <nav id="tp_jeu">
            <a href="/tp_jeu/index.html">Accueil</a>
            <a href="/tp_jeu/html/cards.html">Personnages</a>
            <a href="/tp_jeu/html/create.html">Cr√©er</a>
        </nav>
        <br>
        <br>
        <div class="d-flex flex-wrap justify-content-around" id="mainCard"></div>

        <script src="/tp_jeu/js/function.js" ></script>
        
        <!-- edit character form -->
        <div class="modal fade" id="editCharacterModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
           <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalLabel"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
    
                    <div class="modal-body" id="input">
                        <div>
                            <label class="form-label">Name</label>
                            <input type="text" class="form-control" placeholder="Character Name" id="Name">
                        </div>
                        <div>
                            <label class="form-label">Class</label>
                            <select class="form-select" id="Class">
                                <option value="Warrior">Warrior</option>
                                <option value="Wizard">Wizard</option>
                                <option value="Hunter">Hunter</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Weapon</label>
                            <select class="form-select" id="Weapon">
                                <option value="Sword">Sword</option>
                                <option value="Staff">Staff</option>
                                <option value="Bow">Bow</option>
                            </select>
                        </div>
                        <div class="range-wrap">
                            <label for="Stamina" class="form-label">Stamina</label>
                            <input type="range" class="form-range" value="50" min="1" max="100" id="Stamina">
                            <output class="bubble"></output>
                        </div>
                        <div class="range-wrap">
                            <label for="Strength" class="form-label">Strength</label>
                            <input type="range" class="form-range" min="1" max="100" id="Strength">
                            <output class="bubble"></output>
                        </div>
                        <div class="range-wrap">
                            <label for="Agility" class="form-label">Agility</label>
                            <input type="range" class="form-range" min="1" max="100" id="Agility">
                            <output class="bubble"></output>
                        </div>
                        <div class="range-wrap">
                            <label for="Intelligence" class="form-label">Intelligence</label>
                            <input type="range" class="form-range" min="1" max="100" id="Intelligence">
                            <output class="bubble"></output>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="saveButton">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
        
        <script src="/tp_jeu/js/main.js"></script>
        <script>
            // Get the characters
            var characters = localStorage.getItem('tabCharacters');
            if (characters) {
                characters = JSON.parse(characters, 'UTF-8');

                // Displays the differents cards
                for (let i = 0; i < characters.length; i++) {
                    const element = characters[i];
                    var tabCharacters = JSON.stringify(characters);
                    localStorage.setItem('tabCharacters', tabCharacters);
                    displayCards(element, mainCard, i);
                }
            } else document.location.href = '/tp_jeu/html/create.html';

            // Get the modal
            const myModalEl = document.getElementById('editCharacterModal');

            myModalEl.addEventListener('show.bs.modal', function (event) {
                // Get the right id of the selected button
                const uwu = event.relatedTarget.getAttribute('data-id');

                // Pre-filled the edit form
                putCharacterData(uwu);

                // Functions for sliders on the edit form (main.js)
                const allRanges = document.querySelectorAll(".range-wrap");
                allRanges.forEach(wrap => {
                    const range = wrap.querySelector(".form-range");
                    const bubble = wrap.querySelector(".bubble");

                    range.addEventListener("input", () => {
                        setBubble(range, bubble);
                    });
                    setBubble(range, bubble);
                });
                // it doesn't works when I put the forEach in the main.js
                // it does not load the tooltip after writing the character data.
            });

            // Reload the page when you close the modal
            myModalEl.addEventListener('hide.bs.modal', function() {
                myModalEl.removeEventListener('show.bs.modal', null);
                document.location.reload();
            });
        </script>
        
        <!-- BS bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    </body>
</html>